{% comment %}
  Estelle Atelier - Newsletter Section
  Minimalist email signup with inline validation
{% endcomment %}

<div class="px-6 md:px-12 py-16 md:py-24 {% if section.settings.background_style == 'sage' %}bg-sage-pale{% endif %}" data-section-id="{{ section.id }}">
  <div class="max-w-2xl mx-auto flex flex-col items-center">
    {%- if section.settings.show_decorative_line -%}
      <div class="mb-8 h-[1px] w-12 bg-[var(--text-olive-deep)]/20"></div>
    {%- endif -%}

    <h1 class="serif text-[var(--text-olive-deep)] tracking-tight text-3xl md:text-5xl font-normal leading-tight text-center pb-6">
      {{ section.settings.heading }}
    </h1>

    {%- if section.settings.description != blank -%}
      <p class="text-[var(--text-olive-deep)]/70 text-lg md:text-xl font-light leading-relaxed pb-12 text-center tracking-wide">
        {{ section.settings.description }}
      </p>
    {%- endif -%}

    <div class="max-w-md mx-auto w-full">
      {% form 'customer', class: 'newsletter-form w-full' %}
        <input type="hidden" name="contact[tags]" value="newsletter">

        <div class="flex flex-col gap-4">
          <input
            type="email"
            name="contact[email]"
            id="NewsletterEmail-{{ section.id }}"
            class="w-full border-0 border-b border-[var(--sage-accent)] bg-transparent py-4 px-0 text-[var(--text-olive-deep)] focus:outline-0 focus:border-[var(--sage-dark)] transition-colors placeholder:text-[var(--text-olive-deep)]/30 text-lg font-light leading-normal text-center"
            placeholder="{{ section.settings.placeholder }}"
            required
            aria-label="Email address"
          >

          <button type="submit" class="w-full flex items-center justify-center overflow-hidden rounded-lg h-14 px-8 bg-[var(--sage-dark)] text-white text-base font-medium leading-normal tracking-[0.1em] uppercase hover:bg-[var(--sage-accent)] hover:text-[var(--text-olive-deep)] transition-all active:scale-[0.98]">
            <span class="truncate">{{ section.settings.button_text }}</span>
          </button>
        </div>

        {%- if section.settings.show_privacy_note -%}
          <p class="pt-4 text-[11px] text-[var(--text-olive-deep)]/40 uppercase tracking-[0.2em] text-center">
            {{ section.settings.privacy_note }}
          </p>
        {%- endif -%}

        {%- if form.posted_successfully? -%}
          <div class="mt-6 p-4 bg-[var(--sage-dark)]/10 rounded-lg text-center">
            <p class="text-sm font-medium text-[var(--sage-dark)]">
              {{ 'newsletter.success' | t | default: 'Thank you for subscribing!' }}
            </p>
          </div>
        {%- elsif form.errors -%}
          <div class="mt-6 p-4 bg-red-50 rounded-lg text-center">
            <p class="text-sm font-medium text-red-600">
              {{ form.errors.translated_fields['email'] | default: 'Please enter a valid email address.' }}
            </p>
          </div>
        {%- endif -%}
      {% endform %}
    </div>

    {%- if section.settings.show_decorative_icons -%}
      <div class="mt-16 flex gap-6 items-center justify-center opacity-40">
        {% render 'icon-svg', icon: 'eco' %}
        {% render 'icon-svg', icon: 'diamond' %}
        {% render 'icon-svg', icon: 'filter_vintage' %}
      </div>
    {%- endif -%}
  </div>
</div>

{%- if section.settings.show_decorative_background -%}
  <div class="fixed top-0 left-0 w-full h-full pointer-events-none -z-10 overflow-hidden">
    <div class="absolute -top-[20%] -right-[10%] w-[60%] h-[60%] rounded-full bg-[var(--sage-dark)]/5 blur-[120px]"></div>
    <div class="absolute -bottom-[10%] -left-[5%] w-[40%] h-[40%] rounded-full bg-[var(--sage-dark)]/10 blur-[100px]"></div>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "Newsletter",
  "tag": "section",
  "class": "section-newsletter",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Join the Journal"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Be the first to receive curated collections, seasonal musings, and exclusive invitations to our private events."
    },
    {
      "type": "text",
      "id": "placeholder",
      "label": "Input placeholder",
      "default": "Enter your email address"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Subscribe"
    },
    {
      "type": "select",
      "id": "background_style",
      "label": "Background",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "sage", "label": "Sage pale" }
      ],
      "default": "none"
    },
    {
      "type": "checkbox",
      "id": "show_decorative_line",
      "label": "Show decorative line",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_decorative_icons",
      "label": "Show decorative icons",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_decorative_background",
      "label": "Show decorative background",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_privacy_note",
      "label": "Show privacy note",
      "default": true
    },
    {
      "type": "text",
      "id": "privacy_note",
      "label": "Privacy note",
      "default": "Unsubscribe at any time. View our Privacy Policy."
    }
  ],
  "presets": [
    {
      "name": "Newsletter",
      "category": "Promotional"
    }
  ]
}
{% endschema %}
