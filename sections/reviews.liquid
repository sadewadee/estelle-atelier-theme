{% comment %}
  Estelle Atelier - Reviews Section
  Product reviews with rating summary and review list
{% endcomment %}

<div class="px-6 md:px-12 py-16 md:py-24" data-section-id="{{ section.id }}">
  <div class="max-w-5xl mx-auto">
    <!-- Section Header -->
    <div class="flex flex-col md:flex-row md:items-end justify-between mb-8">
      <div>
        {% if section.settings.label != blank %}
          <span class="text-sage-dark font-bold uppercase tracking-widest text-xs">{{ section.settings.label }}</span>
        {% endif %}
        <h2 class="text-text-olive-deep text-3xl font-bold leading-tight">{{ section.settings.heading }}</h2>
      </div>
      {% if section.settings.show_write_review %}
        <div class="mt-6 md:mt-0">
          <button class="flex min-w-[180px] items-center justify-center rounded-full h-12 px-8 bg-sage-dark text-white gap-2 hover:bg-sage-accent transition-colors font-bold tracking-[0.015em]">
            <span class="material-symbols-outlined text-lg">edit_square</span>
            <span class="truncate">{{ section.settings.write_review_text }}</span>
          </button>
        </div>
      {% endif %}
    </div>

    <!-- Rating Summary Card -->
    <div class="bg-white rounded-2xl border border-sage-accent/30 shadow-sm overflow-hidden mb-12">
      <div class="flex flex-col lg:flex-row">
        <!-- Average Rating -->
        <div class="flex flex-col items-center justify-center p-10 lg:w-1/3">
          <p class="text-text-olive-deep text-6xl font-black leading-tight">{{ section.settings.average_rating }}</p>
          <div class="flex gap-1 my-3">
            {% render 'icon', icon: 'star', class: 'text-sage-dark fill' %}
            {% render 'icon', icon: 'star', class: 'text-sage-dark fill' %}
            {% render 'icon', icon: 'star', class: 'text-sage-dark fill' %}
            {% render 'icon', icon: 'star', class: 'text-sage-dark fill' %}
            {% render 'icon', icon: 'star_half', class: 'text-sage-dark fill' %}
          </div>
          <p class="text-muted text-base font-medium">{{ section.settings.total_reviews }} reviews</p>
          <p class="text-xs text-sage-dark mt-2 font-bold bg-sage-dark/10 px-3 py-1 rounded-full">{{ section.settings.recommended_text }}</p>
        </div>

        <!-- Rating Bars -->
        <div class="flex-1 p-10">
          <div class="space-y-4">
            {% assign star_values = "85,10,3,1,1" | split: "," %}
            {% for star_value in star_values %}
              <div class="flex items-center gap-4">
                <p class="text-text-olive-deep text-sm font-bold w-4">{{ 5 | minus: forloop.index0 }}</p>
                <div class="flex h-2.5 flex-1 overflow-hidden rounded-full bg-sage-accent/30">
                  <div class="rounded-full bg-sage-dark" style="width: {{ star_value }}%;"></div>
                </div>
                <p class="text-muted text-sm font-medium text-right w-10">{{ star_value }}%</p>
              </div>
            {% endfor %}
          </div>
        </div>

        <!-- Review Benefits -->
        {% if section.settings.show_benefits %}
          <div class="hidden xl:flex flex-col justify-center p-10 w-1/4 bg-sage-pale/30">
            <div class="space-y-4">
              <div class="flex items-center gap-3">
                {% render 'icon', icon: 'verified', size: 'md' %}
                <span class="text-sm font-medium">{{ section.settings.benefit_1_text }}</span>
              </div>
              <div class="flex items-center gap-3">
                {% render 'icon', icon: 'photo_library', size: 'md' %}
                <span class="text-sm font-medium">{{ section.settings.benefit_2_text }}</span>
              </div>
              <div class="flex items-center gap-3">
                {% render 'icon', icon: 'update', size: 'md' %}
                <span class="text-sm font-medium">{{ section.settings.benefit_3_text }}</span>
              </div>
            </div>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Filter Tabs -->
    {% if section.settings.show_filters %}
      <div class="mb-8 overflow-x-auto border-b border-sage-accent/30">
        <div class="flex gap-8 min-w-max">
          <button class="review-tab active flex flex-col items-center justify-center border-b-[3px] border-sage-dark text-text-olive-deep pb-3 pt-4 px-2" data-tab="all">
            <p class="text-sm font-bold">All Reviews ({{ section.settings.total_reviews }})</p>
          </button>
          <button class="review-tab flex flex-col items-center justify-center border-b-[3px] border-transparent text-muted hover:text-text-olive-deep pb-3 pt-4 px-2 transition-colors" data-tab="photos">
            <p class="text-sm font-bold">With Photos (45)</p>
          </button>
          <button class="review-tab flex flex-col items-center justify-center border-b-[3px] border-transparent text-muted hover:text-text-olive-deep pb-3 pt-4 px-2 transition-colors" data-tab="verified">
            <p class="text-sm font-bold">Verified Purchases (110)</p>
          </button>
        </div>
      </div>
    {% endif %}

    <!-- Review List -->
    <div class="space-y-6">
      {% for block in section.blocks %}
        <div class="bg-white p-6 md:p-8 rounded-xl border border-sage-accent/30" {{ block.shopify_attributes }}>
          <div class="flex flex-col md:flex-row gap-6">
            <!-- Reviewer Info -->
            <div class="md:w-48 shrink-0">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 rounded-full bg-sage-dark/20 flex items-center justify-center text-sage-dark font-bold">
                  {{ block.settings.reviewer_initials }}
                </div>
                <div>
                  <p class="text-text-olive-deep font-bold text-sm">{{ block.settings.reviewer_name }}</p>
                  <p class="text-muted text-xs">Verified Buyer</p>
                </div>
              </div>
              <p class="text-muted text-xs font-medium uppercase tracking-wider">{{ block.settings.review_date }}</p>
            </div>

            <!-- Content -->
            <div class="flex-1">
              <div class="flex gap-0.5 mb-3">
                {% assign rating = block.settings.rating | default: 5 %}
                {% for i in (1..5) %}
                  {% if i <= rating %}
                    <span class="material-symbols-outlined fill text-sage-dark text-sm">star</span>
                  {% else %}
                    <span class="material-symbols-outlined text-sage-accent text-sm">star</span>
                  {% endif %}
                {% endfor %}
              </div>
              <h4 class="text-text-olive-deep font-bold text-lg mb-2">{{ block.settings.review_title }}</h4>
              <p class="text-text-olive-deep/80 leading-relaxed text-base mb-4">
                {{ block.settings.review_content }}
              </p>

              <!-- Review Photos -->
              {% if block.settings.show_photos and block.settings.review_photos != blank %}
                <div class="flex gap-2 mb-4">
                  {% for i in (1..3) %}
                    <div class="w-20 h-20 rounded-lg bg-sage-accent/30"></div>
                  {% endfor %}
                </div>
              {% endif %}

              <!-- Helpful Buttons -->
              {% if section.settings.show_helpful %}
                <div class="flex items-center gap-4 border-t border-sage-accent/30 pt-4 mt-4">
                  <span class="text-xs text-muted">Was this helpful?</span>
                  <button class="flex items-center gap-1 text-xs font-bold text-text-olive-deep hover:text-sage-dark transition-colors">
                    <span class="material-symbols-outlined text-sm">thumb_up</span>
                    {{ block.settings.helpful_count | default: 0 }}
                  </button>
                  <button class="flex items-center gap-1 text-xs font-bold text-text-olive-deep hover:text-sage-dark transition-colors">
                    <span class="material-symbols-outlined text-sm">thumb_down</span>
                    {{ block.settings.not_helpful_count | default: 0 }}
                  </button>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Reviews",
  "tag": "section",
  "class": "section-reviews",
  "settings": [
    {
      "type": "text",
      "id": "label",
      "label": "Label",
      "default": "Customer Voice"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Verified Reviews"
    },
    {
      "type": "checkbox",
      "id": "show_write_review",
      "label": "Show write review button",
      "default": true
    },
    {
      "type": "text",
      "id": "write_review_text",
      "label": "Write review text",
      "default": "Write a Review"
    },
    {
      "type": "header",
      "content": "Rating Summary"
    },
    {
      "type": "text",
      "id": "average_rating",
      "label": "Average rating",
      "default": "4.8"
    },
    {
      "type": "text",
      "id": "total_reviews",
      "label": "Total reviews",
      "default": "124"
    },
    {
      "type": "text",
      "id": "recommended_text",
      "label": "Recommended text",
      "default": "94% Recommended"
    },
    {
      "type": "checkbox",
      "id": "show_benefits",
      "label": "Show benefits",
      "default": true
    },
    {
      "type": "text",
      "id": "benefit_1_text",
      "label": "Benefit 1",
      "default": "100% Genuine"
    },
    {
      "type": "text",
      "id": "benefit_2_text",
      "label": "Benefit 2",
      "default": "45 Photos Uploaded"
    },
    {
      "type": "text",
      "id": "benefit_3_text",
      "label": "Benefit 3",
      "default": "Last 24h: 3 reviews"
    },
    {
      "type": "header",
      "content": "Filters"
    },
    {
      "type": "checkbox",
      "id": "show_filters",
      "label": "Show filter tabs",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_helpful",
      "label": "Show helpful buttons",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "review",
      "name": "Review",
      "settings": [
        {
          "type": "text",
          "id": "reviewer_name",
          "label": "Reviewer name",
          "default": "Sarah M."
        },
        {
          "type": "text",
          "id": "reviewer_initials",
          "label": "Reviewer initials",
          "default": "SM"
        },
        {
          "type": "text",
          "id": "review_date",
          "label": "Review date",
          "default": "Oct 12, 2023"
        },
        {
          "type": "range",
          "id": "rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5,
          "label": "Rating"
        },
        {
          "type": "text",
          "id": "review_title",
          "label": "Review title",
          "default": "Absolutely stunning piece!"
        },
        {
          "type": "textarea",
          "id": "review_content",
          "label": "Review content",
          "default": "The quality of the silk is beyond what I expected. The sage green color is even more beautiful in person."
        },
        {
          "type": "checkbox",
          "id": "show_photos",
          "label": "Show photos",
          "default": false
        },
        {
          "type": "text",
          "id": "review_photos",
          "label": "Review photos (placeholder)"
        },
        {
          "type": "number",
          "id": "helpful_count",
          "label": "Helpful count",
          "default": 14
        },
        {
          "type": "number",
          "id": "not_helpful_count",
          "label": "Not helpful count",
          "default": 0
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Reviews",
      "category": "Product",
      "blocks": [
        {
          "type": "review"
        },
        {
          "type": "review"
        },
        {
          "type": "review"
        }
      ]
    }
  ]
}
{% endschema %}
