{% comment %}
  Estelle Atelier - Social Community Gallery Section
  Displays Instagram/social feed style grid with shop-the-look
{% endcomment %}

<div class="px-6 md:px-12 py-16 {% if section.settings.background_style == 'sage' %}bg-sage-pale{% endif %}">
  <div class="max-w-[1800px] mx-auto">
    <!-- Section Header -->
    <div class="flex flex-col md:flex-row md:items-end justify-between gap-6 mb-12">
      <div class="max-w-2xl">
        {% if section.settings.show_label %}
          <span class="text-[var(--sage-dark)] text-xs font-bold uppercase tracking-[0.2em] mb-2 block">{{ section.settings.label_text }}</span>
        {% endif %}
        <h2 class="text-3xl md:text-5xl font-bold tracking-tight text-[var(--text-olive-deep)]">{{ section.settings.heading }}</h2>
        {% if section.settings.description != blank %}
          <p class="text-lg text-muted mt-4 font-light leading-relaxed">{{ section.settings.description }}</p>
        {% endif %}
      </div>
      {% if section.settings.show_social_links %}
        <div class="flex gap-4">
          {% if section.settings.instagram_url != blank %}
            <a href="{{ section.settings.instagram_url }}" class="flex items-center gap-2 rounded-lg h-12 px-6 bg-white border border-[var(--sage-accent)]/30 text-[var(--text-olive-deep)] text-sm font-medium hover:bg-[var(--color-sage-pale)] transition-colors">
              {% render 'icon-svg', icon: 'photo_camera' %}
              {{ section.settings.instagram_text }}
            </a>
          {% endif %}
          {% if section.settings.tiktok_url != blank %}
            <a href="{{ section.settings.tiktok_url }}" class="flex items-center gap-2 rounded-lg h-12 px-6 bg-white border border-[var(--sage-accent)]/30 text-[var(--text-olive-deep)] text-sm font-medium hover:bg-[var(--color-sage-pale)] transition-colors">
              {% render 'icon-svg', icon: 'video_library' %}
              {{ section.settings.tiktok_text }}
            </a>
          {% endif %}
        </div>
      {% endif %}
    </div>

    <!-- Category Tabs (Optional) -->
    {% if section.settings.enable_category_tabs %}
      <div class="mb-10 overflow-x-auto border-b border-sage-accent/30">
        <div class="flex min-w-max">
          <button class="category-tab border-b-2 border-[var(--sage-dark)] px-8 py-4 text-sm font-bold text-[var(--text-olive-deep)]" data-category="all">All Looks</button>
          <button class="category-tab border-b-2 border-transparent px-8 py-4 text-sm font-medium text-muted hover:text-[var(--text-olive-deep)] transition-colors" data-category="summer">Summer Linen</button>
          <button class="category-tab border-b-2 border-transparent px-8 py-4 text-sm font-medium text-muted hover:text-[var(--text-olive-deep)] transition-colors" data-category="minimalist">Minimalist</button>
          <button class="category-tab border-b-2 border-transparent px-8 py-4 text-sm font-medium text-muted hover:text-[var(--text-olive-deep)] transition-colors" data-category="evening">Evening Wear</button>
        </div>
      </div>
    {% endif %}

    <!-- Gallery Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" data-social-gallery>
      {% for block in section.blocks %}
        <div class="group relative rounded-xl overflow-hidden aspect-[4/5] shadow-sm bg-sage-pale/30" {{ block.shopify_attributes }}>
          {% if block.settings.image != blank %}
            {{
              block.settings.image
              | image_tag:
                class: 'absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110',
                loading: 'lazy',
                widths: '300, 450, 600, 900, 1200',
                sizes: '(max-width: 640px) 50vw, (max-width: 1024px) 33vw, 25vw'
            }}
          {% else %}
            {{ 'image' | placeholder_svg_tag: 'absolute inset-0 w-full h-full bg-sage-pale' }}
          {% endif %}

          <!-- Overlay -->
          <div class="social-gallery-overlay absolute inset-0 bg-black/40 backdrop-blur-[2px] flex flex-col justify-end p-6 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
            <div class="mb-4">
              <span class="text-white font-semibold text-sm">{{ block.settings.username }}</span>
              {% if block.settings.product != blank %}
                <div class="mt-3 bg-white/95 p-3 rounded-lg flex items-center gap-3">
                  {% if block.settings.product.featured_image %}
                    <div class="w-12 h-12 rounded bg-sage-pale bg-cover bg-center overflow-hidden">
                      {{ block.settings.product.featured_image | image_tag:
                        class: 'w-full h-full object-cover',
                        loading: 'lazy',
                        widths: '48, 96, 144',
                        sizes: '3rem'
                      }}
                    </div>
                  {% endif %}
                  <div class="flex-1">
                    <p class="text-[10px] text-muted uppercase tracking-widest">Shop the look</p>
                    <p class="text-xs font-bold text-[var(--text-olive-deep)]">{{ block.settings.product.title }}</p>
                  </div>
                  <a href="{{ block.settings.product.url }}" class="text-[var(--sage-dark)]  text-xl" aria-label="Shop product">{% render 'icon-svg', icon: 'shopping_bag', size: '24', class: 'text-[var(--sage-dark)]  text-xl' %}</a>
                </div>
              {% elsif block.settings.link != blank %}
                <a href="{{ block.settings.link }}" class="mt-3 inline-block bg-white/95 px-4 py-2 rounded-lg text-xs font-bold text-[var(--text-olive-deep)]">
                  {{ block.settings.link_text }}
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Load More (if more than default blocks) -->
    {% if section.settings.show_load_more %}
      <div class="mt-16 flex flex-col items-center gap-6">
        <button class="min-w-[200px] h-14 rounded-lg bg-[var(--sage-dark)]/20 border border-[var(--sage-dark)]/50 text-[var(--text-olive-deep)] font-bold text-sm hover:bg-[var(--sage-dark)] hover:text-white transition-all flex items-center justify-center gap-2">
          {% render 'icon-svg', icon: 'expand_more' %}
          Load More Stories
        </button>
      </div>
    {% endif %}

    <!-- Community CTA -->
    {% if section.settings.show_cta %}
      <section class="mt-24 rounded-2xl bg-[var(--color-sage-pale)] p-12 text-center border border-[var(--sage-accent)]/50">
        <h3 class="text-3xl font-bold mb-4 text-[var(--text-olive-deep)]">{{ section.settings.cta_heading }}</h3>
        <p class="text-muted mb-8 max-w-xl mx-auto">
          {{ section.settings.cta_text }}
        </p>
        {% if section.settings.cta_button_text != blank %}
          <a href="{{ section.settings.cta_button_link }}" class="inline-block bg-[var(--sage-dark)] text-white px-10 h-12 rounded-lg font-bold text-sm tracking-wide shadow-lg">
            {{ section.settings.cta_button_text }}
          </a>
        {% endif %}
      </section>
    {% endif %}
  </div>
</div>

{% style %}
  .social-gallery-overlay {
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
  }
  .group:hover .social-gallery-overlay {
    opacity: 1;
  }
{% endstyle %}

{% schema %}
{
  "name": "Social Gallery",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Curated Styles by You"
    },
    {
      "type": "checkbox",
      "id": "show_label",
      "label": "Show label",
      "default": true
    },
    {
      "type": "text",
      "id": "label_text",
      "label": "Label text",
      "default": "Community"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "A celebration of our community's unique aesthetics. Tag us to be featured."
    },
    {
      "type": "checkbox",
      "id": "enable_category_tabs",
      "label": "Enable category tabs",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_social_links",
      "label": "Show social links",
      "default": true
    },
    {
      "type": "url",
      "id": "instagram_url",
      "label": "Instagram URL"
    },
    {
      "type": "text",
      "id": "instagram_text",
      "label": "Instagram text",
      "default": "Instagram"
    },
    {
      "type": "url",
      "id": "tiktok_url",
      "label": "TikTok URL"
    },
    {
      "type": "text",
      "id": "tiktok_text",
      "label": "TikTok text",
      "default": "TikTok"
    },
    {
      "type": "select",
      "id": "background_style",
      "label": "Background",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "sage",
          "label": "Sage pale"
        }
      ],
      "default": "none"
    },
    {
      "type": "checkbox",
      "id": "show_load_more",
      "label": "Show load more button",
      "default": false
    },
    {
      "type": "header",
      "content": "Community CTA"
    },
    {
      "type": "checkbox",
      "id": "show_cta",
      "label": "Show CTA section",
      "default": true
    },
    {
      "type": "text",
      "id": "cta_heading",
      "label": "CTA heading",
      "default": "Want to be featured?"
    },
    {
      "type": "textarea",
      "id": "cta_text",
      "label": "CTA text",
      "default": "Share your Estelle Atelier style on Instagram or TikTok and use our official hashtag."
    },
    {
      "type": "text",
      "id": "cta_button_text",
      "label": "CTA button text",
      "default": "Tag #EstelleAtelier"
    },
    {
      "type": "url",
      "id": "cta_button_link",
      "label": "CTA button link"
    }
  ],
  "blocks": [
    {
      "type": "gallery_item",
      "name": "Gallery Item",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "username",
          "label": "Username",
          "default": "@username"
        },
        {
          "type": "product",
          "id": "product",
          "label": "Linked product"
        },
        {
          "type": "header",
          "content": "Or use custom link"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        },
        {
          "type": "text",
          "id": "link_text",
          "label": "Link text",
          "default": "View Post"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Social Gallery",
      "category": "Social",
      "blocks": [
        {
          "type": "gallery_item"
        },
        {
          "type": "gallery_item"
        },
        {
          "type": "gallery_item"
        },
        {
          "type": "gallery_item"
        }
      ]
    }
  ]
}
{% endschema %}
